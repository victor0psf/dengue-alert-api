<div class="container-fluid last-three">
  <h3>Last 3 Epidemiological Weeks</h3>

  <div class="sync-container">
    <button class="btn btn-primary mb-3" (click)="sync()" [disabled]="loading">
      {{ loading ? "Sincronizando..." : "Sync Alerts" }}
    </button>

    <div *ngIf="message" class="alert alert-success">{{ message }}</div>
    <div *ngIf="error" class="alert alert-danger">{{ error }}</div>

    <div class="cards-row" *ngIf="!loading && lastThree?.length">
      <div class="card week-card" *ngFor="let a of lastThree">
        <div class="card-body">
          <h5 class="card-title">Week: {{ a.SE }}</h5>
          <p class="card-text">
            <strong>Estimated:</strong> {{ a.casos_est ?? "-" }}<br />
            <strong>Reported:</strong> {{ a.casos ?? "-" }}<br />
          </p>
          <small class="text-muted">Model: {{ a.versao_modelo }}</small>
        </div>
      </div>
    </div>

    <h4 class="mt-4">Detailed Table (Latest 3)</h4>
    <table class="table table-striped" *ngIf="lastThree?.length">
      <thead>
        <tr>
          <th>Semana epidemiológica (SE)</th>
          <th>Casos estimados</th>
          <th>Casos notificados</th>
          <th>Nível de alerta</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let a of lastThree">
          <td>{{ a.SE }}</td>
          <td>{{ a.casos_est }}</td>
          <td>{{ a.casos }}</td>
          <td>
            <span class="alert-level level-{{ a.nivel }}">
              <span class="icon"></span>
              {{ a.nivel }}
            </span>
          </td>
        </tr>
      </tbody>
    </table>

    <div *ngIf="!lastThree || lastThree.length === 0" class="text-muted">
      No data yet. Try sync first.
    </div>
  </div>
</div>

<div class="navigation-buttons">
  <button routerLink="/search" class="btn-nav">Pesquisar Semana</button>
  <button routerLink="/alertas-6-meses" class="btn-nav">
    Alertas - Últimos 6 Meses
  </button>
</div>
